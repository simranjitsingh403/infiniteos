import{r,j as R}from"./client-DVrblGvH.js";import{f as A,g as M}from"./maths-BcBSyK5V.js";import{c as E}from"./utils-D1OA0j0r.js";const H=r.forwardRef(({folder:h,animationId:g,imagesCount:o=1,containerClassName:k,canvasClassName:S},$)=>{const a={index:0},i=r.useRef(null),n=r.useRef(null),[d,b]=r.useState(null),[v,y]=r.useState(!1),s=r.useRef([]),[l,I]=r.useState(0),c=r.useCallback(e=>{if(n.current&&d&&s.current[e]){d.clearRect(0,0,n.current.width,n.current.height);const t=s.current[e];if(t){const{offsetX:u,offsetY:p,imgWidth:x,imgHeight:w}=A(n.current.width,n.current.height,t.naturalWidth,t.naturalHeight);d.drawImage(t,u,p,x,w)}}},[s,d]),P=r.useCallback(e=>{if(e){n.current=e;const t=e.getContext("2d");t&&b(t)}},[]);r.useEffect(()=>{const e=new Image;e.src=`/animations/${h}/${g}/0.webp`,e.onload=()=>{s.current[0]=e,c(0)}},[c,s,h,g]);const m=r.useCallback(()=>{n.current&&(n.current.width=n.current.clientWidth,n.current.height=n.current.clientHeight,c(0))},[c]);r.useEffect(()=>(window.addEventListener("resize",m),m(),()=>window.removeEventListener("resize",m)),[m]);const j=async()=>{if(v)return;const e=[...Array(o).keys()].map((u,p)=>new Promise((x,w)=>{const f=new Image;f.src=`/animations/${h}/${g}/${p+1}.webp`,f.onload=()=>x(f),f.onerror=w})),t=await Promise.allSettled(e);s.current=[s.current[0],...t.map(u=>u.status==="fulfilled"?u.value:void 0)],y(!0)};return r.useImperativeHandle($,()=>({async onMouseEnter(){var t;v||await j();const e=l;(t=i.current)==null||t.kill(),i.current=M.timeline(),i.current.fromTo(a,{index:l},{index:o,duration:o-e>25?Math.round((o-e)/45):.5,ease:`steps(${o-e})`,onUpdate:()=>{I(Math.round(a.index)),c(Math.round(a.index))}})},onMouseLeave(){var t;const e=l;(t=i.current)==null||t.kill(),i.current=M.timeline(),i.current.fromTo(a,{index:l},{index:1,duration:e>25?Math.round(e/45):.5,onUpdate:()=>{I(Math.round(a.index)),c(Math.round(a.index))}})}})),R.jsx("div",{className:E(k),children:R.jsx("canvas",{ref:P,className:E(S)})})});H.displayName="AnimatedImage";export{H as A};
